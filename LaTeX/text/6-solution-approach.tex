% -----------------------------------------------------------------------------
% Solution Approach
% -----------------------------------------------------------------------------
\chapter{Solution Approach}
\label{chap:approach}
The process of \textit{spacial ANC} seeks to reduce the residual signal at any point $\mathbf{x} \equiv \{r,\theta_x, \phi_x\}$ within the region of interest. The residual signal is given by
\begin{equation}
    e(\mathbf{x},k) = v(\mathbf{x},k) + s(\mathbf{x},k),
\end{equation}
where\\
$k$ is the wave number,\\
$v(\mathbf{x},k)$ is the primary noise field observed at a point $\mathbf{x}$ i.e. the noise field generated by the noise source and its reverberation in the room.\\
$s(\mathbf{x},k)$ is the secondary noise field i.e. the \textit{anti-}noise field emitted by the set of loudspeakers on behalf of the ANC process.
\section{Primary Noise Field}
The primary noise field can be expressed using the spherical harmonics decomposition in (\ref{eq:wave_field_decomposition}). Within the region of interest the noise field can be approximated with a finite number of modes with truncation order of $N = \lceil ekR_1/2\rceil$ \cite{Kennedy2007}. The primary noise will therefore be expressed by
\begin{equation}
    v(\mathbf{x},k) \approx \sum_{u=0}^N \sum_{m=-u}^u\beta_{um}(k)j_u(kr)Y_{um}(\theta_x,\phi_x),
    \label{eq:primary_noise_field}
\end{equation}
where\\
$R_1$ is the radius of the quiet zone,\\
$\beta_{um}$ are the harmonic coefficients representing the primary noise field in the wave domain.\\\\
Putting the harmonic coefficients in vector form we get:
\begin{equation}
    \boldsymbol{\beta}(k) = [\beta_{0,0}(k),\beta_{1,-1}(k),...\beta_{N,N}(k)]^T
\end{equation}

\section{Secondary Noise Field}
Applying a simple loudspeaker model the secondary noise field can be represented by \cite{Zhang2019}
\begin{equation}
    s(\mathbf{x},k) = \sum_{l=1}^Ld_l(k)G(x|\mathbf{y}_l,k),
    \label{eq:secondary_noise_field_atf}
\end{equation}
where\\
$d_l(k)$ is the driving signal for the $l^{th}$ loudspeaker,\\
$\mathbf{y}_l$ is the location of the $l^{th}$ loudspeaker,\\
$G(x|\mathbf{y}_l,k)$ is the acoustic transfer function between the $l^{th}$ loudspeaker and the observation point $\mathbf{x}$.\\\\
\textit{Nota}\\
The acoustic transfer function $G(x|\mathbf{y}_l,k)$ includes the reflections stemming from the walls of the room.\\\\
Similar to the primary noise field in (\ref{eq:primary_noise_field}) the secondary noise field can be approximated by
\begin{equation}
    s(\mathbf{x},k) \approx \sum_{u=0}^N \sum_{m=-u}^u\gamma_{um}(k)j_u(kr)Y_{um}(\theta_x,\phi_x),
    \label{eq:secondary_noise_field}
\end{equation}
where\\
$\gamma_{um}$ are the harmonic coefficients representing the secondary noise field in the wave domain.\\\\

The acoustic transfer function in (\ref{eq:secondary_noise_field_atf}) can be expressed in the wave domain as \cite{Betlehem2005}
\begin{equation}
    G(x|\mathbf{y}_l,k) \approx \sum_{u=0}^N \sum_{m=-u}^u\eta^{(l)}_{um}(k)j_u(kr)Y_{um}(\theta_x,\phi_x)
    \label{eq:ATF_wavedomain}
\end{equation}
where\\
$\eta^{(l)}_{um}$ are the harmonic coefficients representing the acoustic transfer function for the $l^{th}$ loudspeaker in the wave domain.\\\\
By substituting (\ref{eq:secondary_noise_field}) and (\ref{eq:ATF_wavedomain}) into (\ref{eq:secondary_noise_field_atf}) the harmonic coefficients secondary source can also be represented by
\begin{equation}
    \gamma_{um}(k) = \sum_{l=1}^Ld_l(k)\eta_{um}^{(l)}(k).
\end{equation}
in matrix form:
\begin{equation}
    {\boldsymbol{\gamma}}(k)=\boldsymbol{\eta}(k) \mathbf{d}(k),
\end{equation}
where\\
\begin{equation}
    \boldsymbol{\eta}(k) = 
    \begin{bmatrix}
        \eta_{00}^{(1)}(k) & \eta_{00}^{(2)}(k) & \hdots & \eta_{00}^{(L)}(k)\\
        \eta_{-11}^{(1)}(k) & \eta_{-11}^{(2)}(k) & \hdots & \eta_{-11}^{(L)}(k)\\
        \vdots & \vdots & \ddots & \vdots\\
        \eta_{NN}^{(1)}(k) & \eta_{NN}^{(2)}(k) & \hdots & \eta_{NN}^{(L)}(k)
    \end{bmatrix}
\end{equation}
and\\
\begin{equation}
    \boldsymbol{d}(k) = [d_1(k),...,d_L(k)]^T.
\end{equation}
The acoustic transfer function for each loudspeaker to each microphone can be computed knowing the position of the loudspeakers and dimensions of the room, the exact working of this is discussed in \textit{section \ref{sec:Simulation}}. Subsequently the method explained in \textit{section \ref{sec:sampling}} can be used to determine the harmonic coefficients $\eta^{(l)}_{um}(k)$ for the acoustic transfer function. The same can be done to determine the harmonic coefficients $\beta_{um}$ for the primary noise field.\\\\
What remains to be done is setting the driving signal $d_l(k)$ for each loudspeaker appropriately to emit a secondary noise field $s(\mathbf{x},k)$ inciting a reduction of the residual noise e(\mathbf{x},k) in the region of interest thus resulting in a quiet zone.


\section{Matching Noise Fields}
Having determined the primary noise field and the acoustic transfer function in the wave domain one method of deriving the driving signal for the loudspeakers is simply to match the secondary noise field harmonic coefficients to the primary noise field harmonic coefficients\cite{Zhang2019}:
\begin{equation}
    \boldsymbol{\eta}(k)\mathbf{d}(k)=-\boldsymbol{\beta}(k).
    \label{eq:matching}
\end{equation}
When choosing the number of loudspeakers there's three possible cases that determine the solution to the harmonic coefficients matching:

\subsubsection{Case 1: $L = (N + 1)^2$}
When the number of loudspeakers $L$ is equal to the number of modes $(N+1)^2$ then there's one unique solution to \ref{eq:matching} given by\cite{Zhang2019}:
\begin{equation}
    \mathbf{d}(k) = -(\boldsymbol{\eta}(k))^{-1}\boldsymbol{\beta}(k),
\end{equation}
where\\
$(.)^{-1}$ is the inverse matrix.\\\\
\textit{Memoriae}\\
The number of modes is dependant on the frequency and the radius of the region of interest.
\subsubsection{Case 2: $L > (N + 1)^2$}
When the number of loudspeaker is greater than the number of modes then there's either no solution or an infinite number of solutions\cite{Zhang2019}.
\subsubsection{Case 3: $L = (N + 1)^2$}
This case is worthy of further consideration as it is the most viable for implementing a realistic \textit{spatial ANC} system. When the number of loudspeakers is lesser then the number of modes then there's is an exact solution only in a very special case\cite{Zhang2019}. In general however \textit{(and this will be of greater interest)} there's no exact solution and an approximation is necessary.
\subsection{Least Squares Method}

\subsubsection{Wave-Domain Least Square Method}
Applying the least square method on (\ref{eq:matching}) for \textit{case 3} comes back to solving the problem
\begin{equation}
    min||\boldsymbol{\eta}(k)\boldsymbol{d}(k)-(-\boldsymbol{\beta}(k))||^2
\end{equation}
The optimal solution to this problem is\cite{Zhang2019}
\begin{equation}
    \boldsymbol{d}(k) = -(\boldsymbol{\eta}(k))^\dagger\boldsymbol{\beta}(k),
\end{equation}
where\\
$(.)^\dagger$ is the pseudoinverse matrix.
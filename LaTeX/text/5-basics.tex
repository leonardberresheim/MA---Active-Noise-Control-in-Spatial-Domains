% -----------------------------------------------------------------------------
% Fundamentals
% -----------------------------------------------------------------------------
\chapter{Fundamentals}
\label{chap:fundamentals}

\section{Propagation of sound}
An acoustic wave is essentially a change in pressure. A local pressure change causes the surrounding medium to compress which in turn causes pressure changes thus leading to the propagation of an acoustic wave. This compression leads to a displacement of the particles in the medium.\\The linear wave equation can be used to describe such an acoustic wave. In reality the acoustic wave equation is non linear but for this application the linear approximation to the wave equation is a good model.\cite{Acoustic}\\
\subsection{Linearity}
Viewing acoustics as a linear phenomenon is very appealing due to the principle of superposition roughly depicted by following relation
\begin{equation}
    \mathcal{L}(af_1+bf_2) = a\mathcal{L}(f_1) + b\mathcal{L}(f_2),
\end{equation}
where
$f_1$ and $f_2$ are two causes,\\
$\mathcal{L}(f)$ is the set of possible computational steps that predict the effect of $f$.\\
Thus a complex sound field stemming from multiple sources can be regarded as the sum of sound fields produced by each source individually. In the same way a complex wave can be analyzed by each frequency separately. Nevertheless this acoustic model only represents an approximation\cite{Rossing2007}.\\
\\
The following three laws are used to develop the wave equation.
\subsection{Equation of State}
The equation of state relates changes in pressure and density. It is determined by thermodynamic properties and dependant upon the material. The equation of state for linear acoustic waves in fluid is  given by\cite{Acoustic}
\begin{equation}
    p = \mathbf{B}s = \rho_0c^2s,
\end{equation}
where 
$\mathbf{B}=\rho_0(\frac{\partial P}{\partial \rho})_{\rho_0}$ is the adiabatic bulk modulus,\\
$\rho$ in $kg/mÂ³$ is the density,
$\rho_0$ is the undisturbed density,\\
$p$ in $Pascal$ where $1Pa = 1 N/m^2 = 1kg/s^2/m$ is the pressure,\\
$P$ is the instantaneous pressure,\\
$c$ in $m/s$ is the speed of sound,\\
$s = \frac{\rho-\rho_0}{\rho_0}$ is the condensation 
\subsection{Equation of Continuity}
The equation of continuity depicts the conservation of mass:
\begin{equation}
    \frac{\partial\rho}{\partial t} = -\rho_0\nabla\cdot\Vec{u},
\end{equation}
where\\
$t$ is time,\\
$\nabla$ is the Nabla operator.\\
$\Vec{u} = \frac{\partial\Vec{\xi}}{\partial t}$ is the particle velocity,\\
$\Vec{\xi}$ is the particle displacement,\\
$\Vec{x}$ is the particle position.
\subsection{Equation of Motion}
The Equation of motion describes how a pressure variation generates a force that causes particle motion:
\begin{equation}
    -\nabla p = \rho_0 \cdot \frac{\partial\Vec{u}}{\partial t}
\end{equation}
\subsection{Wave Equation}
The wave equation or the equation of propagation of acoustic pressure can be derived from the three preceding equations:
\begin{equation}
    \frac{1}{c^2}\frac{\partial^2p}{\partial t^2} = \nabla^2p
\end{equation}
in Cartesian coordinates $(x,y,z)$:
\begin{equation}
    \frac{1}{c^2}\frac{\partial^2p}{\partial t^2} = \frac{\partial^2p}{\partial x^2} + \frac{\partial^2p}{\partial y^2} + \frac{\partial^2p}{\partial z^2},
\end{equation}
in Polar coordinates $(r,\theta, z)$:
\begin{equation}
    \frac{1}{c^2}\frac{\partial^2p}{\partial t^2} = \frac{\partial^2p}{r^2\partial \theta^2} + \frac{\partial^2p}{\partial r^2} + \frac{1}{r}\frac{\partial^2p}{\partial r} + \frac{\partial^2p}{\partial z^2},
\end{equation}

\subsection{Spherical Wave Equation}

For now we assume the acoustic source to be a point source, it can thus be represented as a spherical wave. Furthermore we assume "spherical symmetry" i.e. the pressure and particle velocity equal for the same $r$, the distance from the 'origin' of the spherical wave. The wave equation for the spherically symmetric wave is\cite{Waves2004}:
\begin{equation}
    \frac{\partial^2rp(r,t)}{\partial r^2} = \frac{1}{c^2}\frac{\partial^2rp(r,t)}{\partial t^2}.
\end{equation}
\subsubsection{General Solution to the Spherical Wave Equation}
A general solution to the Wave equation is given by the pressure wave emitted by a single frequency point source of acceleration in free space\cite{Allen1979}:
\begin{equation}
    p(\omega,\Vec{x},\Vec{x}') = \frac{e^{i\omega(\frac{r}{c}-t)}}{4\pi r}\quad\quad for\quad r > 0,
\end{equation}
where\\
$p$ is the pressure,\\
$\omega=2\pi f$,\\
$f$ is the frequency,\\
$r=|\Vec{x}-\Vec{x}'|$ is the distance from source to receiver,\\
$\Vec{x}$ is the source location $(x,y,z)$,\\
$\Vec{x}'$ is the receiver location $(x',y',z')$,\\
$i=\sqrt{-1}$.\\
\\
This solution does not contain any term representing the energy source and thus fails at the origin because some source of sound is required to provide the energy carried away.\cite{Acoustic}

\subsubsection{Monopoles - Spherical Wave Equation}
\LARGE TODO : Add explanation for spherical wave / maybe a drawing or something!\\
\normalsize
The problem of the missing sound source is solved by introducing the acoustic monopole source:
\begin{equation}
    \mathbf{\Phi}(r,t) = -\frac{\mathbf{Q}(t)}{4\pi r}\bigg\{\frac{1}{1+ika}\bigg\}e^{-ik(r-a)}, 
\end{equation}
where\\
$a$ is the radius of the emitting sphere,\\
$k = \omega/c$ is the wavenumber,\\
$\mathbf{Q}(t) = 4\pi a^2U_ae^{i\omega t}$ in $m^3/s$ is the source strength,\\
$U_a$ is the radial velocity on the surface,\\
$\mathbf{\Phi}$ is the velocity potential with\\
$p(r,t) = -\rho_0\frac{\partial\phi}{\partial t}$ and\\
$u(r,t) = \frac{\partial phi}{\partial r}$.\\
\\
Thus,\\
\begin{equation}
    \mathbf{p}(r,t) = \frac{\mathbf{Q}(t)}{4\pi r}\bigg\{\frac{ik\rho_0 c}{1+ika}\bigg\}e^{-ik(r-a)}, 
\end{equation}


\section{Spherical Harmonics}
"The spherical harmonics are a set of orthogonal spatial basis functions that can be utilized
to decompose any arbitrary function defined on the sphere."\cite{Samarasinghe2018}\\
A homogeneous incident wave field $v(\mathbf{x},k)$ observed at $\mathbf{x}$ can thus be decomposed into\cite{Zhang2019}:
\begin{equation}
    v(\mathbf{x},k)=\sum_{u=0}^\infty \sum_{m=-u}^u\beta_{um}(k)j_u(kr)\Upsilon_{um}(\Phi_x,\Psi_x),
\end{equation}
for any location with spherical coordinates $\mathbf{x}=(x,\Phi_x,\Psi_x)$\\
where\\
$k=2\pi f/c=$ the wave number,\\
$f=$ the frequency,\\
$c=$ the speed of sound,\\
$j_u(.)=$the spherical Bessel function of order $u$,\\
$\beta_um(k)=$ the wave field in the wave domain.\\ 
$\Upsilon_{um}(.)=$ the spherical harmonics,\\
The spherical harmonics function of order $n$ and mode $m$ is defined by\cite{Samarasinghe2018}
\begin{equation}
    \Upsilon_{um}(\Phi_x,\Psi_x) = \mathbf{P}_{n|m|}(cos(\Phi_x))\frac{1}{\sqrt{2\pi}}e^{im\Psi_x},
\end{equation}
where\\
$\mathbf{P}_{n|m|}(cos(\Phi_x))=$ the associated Legendre polynomials.
\section{Simulating an acoustic source in 3D - space}
Other Methods for simulating rooms acoustics among others:
\begin{itemize}
    \item ray/beam tracing
    \item boundary and finite element methods
    \item digital waveguide meshes
    \item spatial sound decomposition based methods
The image source method still remains a sought-after technique.\cite{Samarasinghe2018}
\end{itemize}

\subsection{Image Source Method}
The image model is a method that allows the computation of a source-to-receiver acoustic transfer function in an enclosed 3D-space. Within this method an acoustic wave produced by a source, when crossing a wall, produces an image which then itself is considered as a source for further computation. In a room with several walls each image then also produces an image.\cite{Allen1979}
\\\\
The exact solution to the wave equation in a rectangular, rigid-wall, room is given by the rooms impulse response function also known as the time domain Green's function\cite{Allen1979}:
\begin{equation}
    p(t,\mathbf{X},\mathbf{X'})=\sum_{p=1}^8\sum_{r=-\infty}^\infty\frac{\delta[t-\frac{|\mathbf{R_p}+\mathbf{R_r}|}{c}]}{4\pi|\mathbf{R_p}+\mathbf{R_r}|},
\end{equation}
where\\ 
$c=$ the speed of sound,\\
$\mathbf{R_p}$ represents the eight vectors given by the eight permutations over $\pm$ of
\begin{equation}
    \mathbf{R_p}=(x\pm x', y\pm y', z\pm z')
\end{equation}
r is the integer vector triplet $(n,l,m)$, and
\begin{equation}
    \mathbf{R_r}=2(nL_x, lL_y, mL_z),
\end{equation}
where $(L_x, L_y, L_z)$ are the room dimensions.
\\
\\
In case of non-rigid walls, the solution to the wave equation becomes more complicated and is only conceivable under the assumption that the wall impedance is proportional to $sec(\theta)$, where $\theta$ is the angle incidence of a plane wave with respect to the wall normal, resulting in the Sabine energy absorption coefficient $\alpha$ for a uniform reflection coefficient $\beta$ on a given wall of the form\cite{Allen1979}:
\begin{equation}
    \alpha=1-\beta^2.
\end{equation}
The modified room impulse response transforms into:
\begin{equation}
    p(t,\mathbf{X},\mathbf{X'})=\sum_{p=1}^8\sum_{r=-\infty}^\infty
    \beta_{x1}^{|n-q|}\beta_{x2}^{|n|}\beta_{y1}^{|i-j|}\beta_{y2}^{|i|}\beta_{z1}^{|m-k|}\beta_{z2}^{|m|}
    \frac{\delta[t-\frac{|\mathbf{R_p}+\mathbf{R_r}|}{c}]}{4\pi|\mathbf{R_p}+\mathbf{R_r}|},
\end{equation}
where\\
$p=(q,j,k)$ and $r=(n,l,m)$ are integer 3-vector,\\
$\mathbf{R_p}$ is now expressed in terms of $p$ as
\begin{equation}
    \mathbf{R_p}=(x-x'+2qx', y-y'+2jy,z-z'+2kz').
\end{equation}


\subsection{Spherical Harmonics Based Image Source Method}
The image source method was developed under the assumption that both source and receiver are omnidirectional. As loudspeaker are inherently directional and the use of directional microphones is increasing it is expedient to use a different approach. By modeling the transducers in the spherical harmonics domain with a more realistic directivity pattern it is possible to achieve a more accurate simulation of room acoustics.\cite{Samarasinghe2018}\\
The spherical harmonics based image source method also known as the generalised image source method is given by
\begin{equation}
    \mathbf{P}(k,\mathbf{x}_s,\mathbf{z}^{(r)} = \sum_{v=0}^V\sum_{u=-v}^v\sum_{n=0}^N\sum_{m=-n}^n\sum_{\mathbf{p}=0}^1\sum_{\mathbf{r}=-\infty}^\infty\beta_{nm}(k)\\
    \times (-1)^...
\end{equation}
\\
\\The advantages of the image source method are its relatively simple algorithmic implementation, its high degree of flexibility - many parameter can be set within the software - as well as its ability to generate a good approximation of the room impulse response. It nevertheless comes with its impediments such as its restriction to rectangular rooms and it's inability to model diffraction.\cite{Samarasinghe2018}


\section{Algorithms}
When trying to conduct active noise control we are confronted with an unknown system i.e. the noise source and its reverberation in the 3D space. It is thus necessary to identify the unknown model by the means of experimental evidence, such as measurement of the input-output desired response signal. Adaptive identification refers to a particular procedure where more about the system is learned with each new pair of measurements.\cite{Glentis1999}
\subsection{Adaptive Filter}
The objective of an adaptive filter consists in finding the optimal parameters $\mathbf{\theta}(k)$, in such a way that its output minimizes an objective function. This objective function $F$ is a function of a generic error signal $e(k)$ which in turn is a function of the input signal $x(k)$, the reference signal $d(k)$ and the adaptive filter output signal $y(k)$\cite{Louv1984}. 
\begin{equation}
    F = F[e(k)] = F[e(x(k),d(k),y(k))],
\end{equation}
satisfying the following properties:\\
\begin{itemize}
    \item Non-negativity $F[x(k), d(k), y(k)] \geq 0, \forall y(k), x(k), d(k)$
    \item Optimality: F[x(k), d(k), d(k)] = 0
\end{itemize}
\\
In other words an adaptive filter changes its coefficient to void an error signal. The filter can be realised as an finite impulse response (FIR), infinite impulse response (IIR), lattice and transform domain filter. One  very common transform domain filter is the least-mean-square algorithm.\cite{Thakkar2017}

\subsubsection{Least Mean Square}
The least-mean square algorithm uses the estimates of the gradient vector from the available data. It implements a procedure that correct the weight vector in the direction of the gradient vectors negative which eventually results in minimum mean square error. Its simplicity and ease of implementation makes the least-mean-square algorithm appealing for real-time systems.\cite{Thakkar2017}
The updating equation for the last-mean-square algorithm is
\begin{equation}
    \mathbf{W}(k+1) = \mathbf{w}(k) + 2\mu e(k)\mathbf{x}k
\end{equation}
where\\
$\mathbf{w}$ is the filter coefficient,\\
$e$ is the estimated error,\\
$x$ is the input signal,\\
$\mu$ is the step size\\
and the error function is given by
\begin{equation}
    e(k) = d(k) - \mathbf{x}^T(k)\mathbf{w}(k)
\end{equation}
where\\
$d$ is the reference signal,\\
$\mathbf{x}^T$ is the transpose of $\mathbf{x}$


\subsubsection{Modeling of Loudspeacker}


